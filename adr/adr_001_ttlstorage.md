# ADR 001

## Использование временного хранилища (ttlstorge)
- статус: proposed
- 2024-07-16

## Контекст
Процесс регистарции(ввод логина и пароля; ввод OTP-пароля; сохранение MasterKey) и двухфазной авторизации(ввод логина и пароля; ввод OTP-пароля) имеют явно выраженные этапы. Завершиться такой процесс должен либо появлением jwt-токена(успех), либо ошибкой ввода паролей (отказом), либо по истечении тайммаута.

## Принятое решение
Данные процесса авторизации и регистрации хранить в "time to live" storage. В текущей реализации - на основе sync.Map; при работе нескольких инстансов можно сделать реализацию на redis.

Данные каждого этапа сохраняются отдельно под своим ключем. При обновлении данных процесса данные предыдущего этапа удаляются. Ключ текущего этапа возвращается 
пользователю.

## Следствия 
 - Операцию, приводящую к изменению процесса регистарации/авторизации можно выполнить только один раз.
 - В постоянной базе будут хранится только данные зарегистрированных пользователей
 - Бизнес-операции ограничиваются механизмом jwt со своим отдельным таймаутом.
 - Таймаут процессов регистрации и авторизации определяется параметром конфигурации AuthStageTimeout.

